---
title: "Used Car Price Estimate"
author: "Bradley Robinson, Luay Dajani"
date: "June 7, 2018"
output: 
  word_document:
    reference_docx: ./template/template2.docx
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

#install.packages("png")

library(knitr)
library(png)
library(grid)
```

```{r datafile, echo=FALSE}
read_chunk('Car_Price_Estimate-Data.R')
```

# Introduction

![](images/generic_toyota.jpg)

Buying a car is a major investment and a big deal in society. Buying a new car is generally a great bet in making sure the car is in prime shape, and pristine condition.  Nevertheless, buying a new car generally means incurring a high initial depreciation cost immediately on driving the car out of the dealership. In 2016, there were approximatley 59.4 million cars 71% being used cars (*ref 1).  The purpose of this excersise is to explain the eBay Germany market price using available explainatory variables provided, while creating a model that can be used for prediction.

# Data Description

The data was downloaded from kaggle "Used cars database, Over 370,000 used cars scraped from Ebay Kleinanzeigen" at  https://www.kaggle.com/orgesleka/used-cars-database.  These are prices listed for cars and not the final price.  In this case, for cleansing data, only fixed price listings were kept while auctions deleted, especially as some listers will drop the price low and not sell unless the price hits a certain threshhold.  Cleansing details are in a table in the Appendix.

``` {r data, echo=FALSE}
<<dataimport>>
#head(dfm_AutoData, n = 2)
```

# Exploratory Data Analysis

Using price as the response variable, the available list of other usable attrubutes of interest include: price, vehicleType, yearOfRegistration, gearbox, powerPS, model, kilometer, fuelType, brand, notRepairedDamage.  Other attributes were not deemed significant for the model as follows:

- DateCrawled and dateCreated indicated the information was generally from 1st half of 2016.
- Name, seller, abtest, and offerType do not have any logical meaning in this context.
- monthOfRegistration may or may not have an impact, but logically speacking, when shopping for a used car, people are less interested in this attribute.

Initally looking into the effect of the variables against each other and price, the following scatter plot basically shows that at least price needs to be logged when comparing to a large selection especially due to the big difference in price differences as a very few cars were extreme outliers in that respect as shown with the following histograms:
``` {r fig.width=3, fig.height=2, echo=FALSE}
<<histogram_plots>>
```

It is clear that logging price will give the best representation of the price, but it does show a huge discrepency between pricing, and a lot of outliers.

``` {r fig.width=5, fig.height=5, echo=FALSE}
img2 <- readPNG("pre-generated/Rplot5.png")
grid.raster(img2)
```

``` {r fig.width=5, fig.height=5, echo=FALSE}
img2 <- readPNG("pre-generated/Rplot06.png")
grid.raster(img2)
```

Though the scatter plot above compares a selection of factors, logically speaking there seems to be very few visual co-dependencies between the other explanatory variables.  Focusing on price as per the below data plots, price with any one explanatory variable does not show any logical trends unless more specific variables are added like brand, model, type, year, and kilometer.

``` {r fig.width=3, fig.height=3, echo=FALSE}
<<explore_data_plots>>
```

In any case, the variables that seem most viable to start off with for a rich model are log(price) = B0(kilometer) +  B1(brand) + B2 (model) + B3(vehicleType) + B4(yearOfRegistration) + B5(PowerPS) +B6(fuelType) starting off without the interactions.

# Objetive 1: Regression

QOI: Car Pricing is heaviy impacted by kilometer, brand, model, vehicleType, and yearOfRegistration.  With our current "RICH" model we want to do a general linear regression initially, then run four different automatic variable selecting techniques including stepwise, LASSO, LARS, and ???.  After Variable selection we want to perform cross validation to ensure the best model.

## Rich model GLM



## Regression Model Selections

## Model Comparisons

## Parameter Interpretation

## Conclusions

# Objective 2: Two-Way ANOVA or Time Series

QOI: Goal

## Main Analysis

## Conclusion

# Appendix

## Data Arrtibutes and Cleansing

The file was cleansed as follows:

Attribute | Description | Action
---|--- |---
dateCrawled         | when advert was first crawled, all field-values are taken from this date | N/A
name                | headline, which the owner of the car gave to the advert | N/A
seller              | 'privat'(ger)/'private'(en) or 'gewerblich'(ger)/'dealer'(en) | Row with invalid value deleted
offerType           | 'Angebot'(ger)/'offer'(en) or 'Gesuch'(ger)/'request'(en) | Auction style deleted (Gesuch)
price               | the price on the advert to sell the car | Deleted Any price < 100 or > 99,000,000 as well as all blanks
abtest              | ebay-intern variable (argumentation in discussion-section) | N/A
vehicleType         | one of eight vehicle-categories 'andere'/'other', 'bus'/'bus', 'cabrio'/'convertible', 'coupe'/'coupe', 'kleinwagen'/'small car', 'kombi'/'station wagon', 'limousine'/'limousine', 'suv'/'suv' | Nothing, though there were blanks
yearOfRegistration  | at which year the car was first registered | Deleted anything < 1925 or > 2016
gearbox             | 'manuell'(ger)/'manual'(en) or 'automatik'(ger)/'automatic'(en) | N/A
powerPS             | the power of the car in PS | Deleted anything < 30 or > 3000 
model               | the cars model | N/A (but there are blanks)
kilometer           | how many kilometres the car has driven | N/A
monthOfRegistration | at which month the car was first registered | N/A
fuelType            | one of seven fuel-categories | N/A (but there are blanks)
brand               | the cars brand
notRepairedDamage   | if the car has a damage which is not repaired yet | N/A (blanks may be considered no previous damage)
dateCreated         | the date for which the advert at 'ebay Kleinanzeigen' was created | N/A
nrOfPictures        | number of pictures in the advert | Attribute deleted
postalCode          | where in germany the car is located | Attribute deleted
lastSeenOnline      | when the crawler saw this advert last online | Attribute deleted

## References & Environment {.smaller}

-1: Number of new and used light vehicle sales in the United States from 2010 to 2017 (in millions): https://www.statista.com/statistics/183713/value-of-us-passenger-cas-sales-and-leases-since-1990/

## Code

#```{r, code=readLines('Car_Price_Estimate-Data.R'), echo=TRUE}
#```

#```{r, code=readLines('Car_Price_Estimate-Regression.R'), echo=TRUE}
#```

#```{r, code=readLines('Car_Price_Estimate-Anova.R'), echo=TRUE}
#```